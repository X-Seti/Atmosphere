#!/bin/bash
# showline - Show specific lines from a file with context
# Usage: showline LINE [CONTEXT] FILE

if [ $# -lt 2 ]; then
    echo "Usage: showline LINE [CONTEXT] FILE"
    echo ""
    echo "Examples:"
    echo "  showline 100 file.py              # Show line 100"
    echo "  showline 100 +5 file.py           # Show lines 100-105"
    echo "  showline 100 5 file.py            # Show 5 lines around line 100"
    echo "  showline 100 file.py 5            # Show 5 lines around line 100 (alt)"
    exit 1
fi

line_num=$1
context=0
file_path=""

# Parse arguments - handle various orders
if [ $# -eq 2 ]; then
    # showline LINE FILE
    file_path=$2
elif [ $# -eq 3 ]; then
    # showline LINE CONTEXT FILE  or  showline LINE FILE CONTEXT
    if [ -f "$2" ]; then
        file_path=$2
        context=$3
    else
        context=$2
        file_path=$3
    fi
fi

# Validate file exists
if [ ! -f "$file_path" ]; then
    echo "Error: File not found: $file_path"
    exit 1
fi

# Validate line number is numeric
if ! [[ $line_num =~ ^[0-9]+$ ]]; then
    echo "Error: Line number must be numeric: $line_num"
    exit 1
fi

# Get total lines in file
total_lines=$(wc -l < "$file_path")

# Handle context
if [[ $context =~ ^\+([0-9]+)$ ]]; then
    # +N means show N lines after
    offset=${BASH_REMATCH[1]}
    end_line=$((line_num + offset))
    [ $end_line -gt $total_lines ] && end_line=$total_lines
    
    echo "━━━ Lines $line_num-$end_line of $file_path ━━━"
    sed -n "${line_num},${end_line}p" "$file_path" | nl -v $line_num -w 6 -s ": "
    
elif [[ $context =~ ^[0-9]+$ ]] && [ $context -gt 0 ]; then
    # N means show N lines before and after
    start_line=$((line_num - context))
    [ $start_line -lt 1 ] && start_line=1
    end_line=$((line_num + context))
    [ $end_line -gt $total_lines ] && end_line=$total_lines
    
    echo "━━━ Lines $start_line-$end_line of $file_path (context: ±$context) ━━━"
    sed -n "${start_line},${end_line}p" "$file_path" | nl -v $start_line -w 6 -s ": " | \
    sed "${line_num}s/^/→ /"
    
else
    # Just show the single line
    if [ $line_num -gt $total_lines ]; then
        echo "Error: Line $line_num exceeds file length ($total_lines lines)"
        exit 1
    fi
    
    echo "━━━ Line $line_num of $file_path ━━━"
    sed -n "${line_num}p" "$file_path" | sed "s/^/→ /"
fi
